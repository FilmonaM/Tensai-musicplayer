<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tensai Music Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Aldrich&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="/main.js" defer></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="nav-item active" data-view="home" title="Home">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 13L12 5L20 13V20C20 20.5523 19.5523 21 19 21H15V14H9V21H5C4.44772 21 4 20.5523 4 20V13Z"/>
                </svg>
            </div>
            <div class="nav-item" data-view="library" title="Library">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <rect x="4" y="6" width="4" height="12" rx="1"/>
                    <rect x="10" y="3" width="4" height="18" rx="1"/>
                    <rect x="16" y="8" width="4" height="10" rx="1"/>
                </svg>
            </div>
            <div class="nav-item" data-view="playlists" title="Playlists">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <rect x="3" y="3" width="18" height="2" rx="1"/>
                    <rect x="3" y="7" width="12" height="2" rx="1"/>
                    <rect x="3" y="11" width="18" height="2" rx="1"/>
                    <rect x="3" y="15" width="12" height="2" rx="1"/>
                </svg>
            </div>
            <div class="nav-item settings-btn" title="Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 15.5C10.07 15.5 8.5 13.93 8.5 12S10.07 8.5 12 8.5 15.5 10.07 15.5 12 13.93 15.5 12 15.5ZM19.43 12.97C19.47 12.65 19.5 12.33 19.5 12S19.47 11.35 19.43 11.03L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.96 19.05 5.05L16.56 6.05C16.04 5.66 15.5 5.32 14.87 5.07L14.5 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.5 2.42L9.13 5.07C8.5 5.32 7.96 5.66 7.44 6.05L4.95 5.05C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.21 8.95 2.27 9.22 2.46 9.37L4.57 11.03C4.53 11.35 4.5 11.67 4.5 12S4.53 12.65 4.57 12.97L2.46 14.63C2.27 14.78 2.21 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.95L7.44 17.94C7.96 18.34 8.5 18.68 9.13 18.93L9.5 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.5 21.58L14.87 18.93C15.5 18.67 16.04 18.34 16.56 17.94L19.05 18.95C19.27 19.03 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.97Z"/>
                </svg>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Home View - Recently Added & Played -->
            <div class="view active" id="home-view">
                <section class="content-section">
                    <h2>RECENTLY ADDED</h2>
                    <div class="media-grid" id="recently-added-grid"></div>
                </section>
                
                <section class="content-section">
                    <h2>RECENTLY PLAYED</h2>
                    <div class="media-grid" id="recently-played-grid"></div>
                </section>
            </div>

            <!-- Library View - All Music Files -->
            <div class="view" id="library-view">
                <div class="library-header">
                    <h2>LIBRARY</h2>
                    <button class="add-files-btn" id="add-files-btn">
                        <i class="fas fa-plus"></i>
                        ADD FILES
                    </button>
                </div>
                <div class="media-grid" id="library-grid"></div>
            </div>

            <!-- Playlists View -->
            <div class="view" id="playlists-view">
                <div class="playlists-header">
                    <h2>PLAYLISTS</h2>
                    <button class="create-playlist-btn" id="create-playlist-btn">
                        <i class="fas fa-plus"></i>
                        CREATE
                    </button>
                </div>
                <div id="playlists-container"></div>
            </div>
        </main>

        <!-- Full Playlist View (Overlay) -->
        <div class="playlist-full-view" id="playlist-full-view">
            <button class="playlist-close-btn" id="playlist-close-btn">&times;</button>
            <div class="playlist-full-header" id="playlist-full-header">
                <!-- Content will be dynamically generated -->
            </div>
            <div class="playlist-full-songs" id="playlist-full-songs">
                <!-- Songs will be dynamically generated -->
            </div>
        </div>

        <!-- Queue Panel (Sidebar) -->
        <div class="queue-panel" id="queue-panel">
            <div class="queue-header">
                <h3>QUEUE (<span id="queue-count">0</span>)</h3>
                <button class="queue-clear" id="queue-clear">CLEAR</button>
            </div>
            <div class="queue-list" id="queue-list"></div>
        </div>

        <!-- Player Controls (Bottom Bar) -->
        <div class="player-controls">
            <!-- Now Playing Info -->
            <div class="now-playing">
                <div class="now-playing-art" id="now-playing-art">
                    <img src="" alt="" style="display: none;">
                </div>
                <div class="now-playing-info">
                    <div class="now-playing-title" id="now-playing-title">-</div>
                    <div class="now-playing-artist" id="now-playing-artist">-</div>
                </div>
            </div>

            <!-- Playback Controls -->
            <div class="player-center">
                <div class="player-buttons">
                    <button class="player-btn" id="prev-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                        </svg>
                    </button>
                    <button class="player-btn primary" id="play-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <g id="play-icon">
                                <path d="M8 5v14l11-7z"/>
                            </g>
                        </svg>
                    </button>
                    <button class="player-btn" id="next-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                        </svg>
                    </button>
                </div>
                <!-- Progress Bar -->
                <div class="progress-container">
                    <span class="time" id="current-time">0:00</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <span class="time" id="total-time">0:00</span>
                </div>
            </div>

            <!-- Additional Controls -->
            <div class="player-right">
                <button class="control-icon-btn" id="shuffle-btn" title="Shuffle">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
                    </svg>
                </button>
                <button class="control-icon-btn" id="queue-toggle" title="Queue">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="4" y="5" width="16" height="2"/>
                        <rect x="4" y="9" width="16" height="2"/>
                        <rect x="4" y="13" width="11" height="2"/>
                        <path d="M17 17v-4l4 2z"/>
                    </svg>
                </button>
                <button class="control-icon-btn" id="repeat-btn" title="Repeat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
                    </svg>
                </button>
                <!-- Volume Control -->
                <div class="volume-control">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                    </svg>
                    <input type="range" id="volume-slider" min="0" max="100" value="70">
                </div>
            </div>
        </div>

        <!-- Hidden Elements -->
        <audio id="audio-player"></audio>
        <input type="file" id="file-input" accept="audio/*,video/mp4" multiple hidden>
        
        <!-- Context Menu (Right-click) -->
        <div class="context-menu" id="context-menu">
            <div class="menu-item" data-action="play">Play</div>
            <div class="menu-item" data-action="add-queue">Add to Queue</div>
            <div class="menu-item has-submenu" data-action="add-playlist">
                Add to Playlist
            </div>
            <div class="menu-separator"></div>
            <div class="menu-item" data-action="edit-image">Edit Image</div>
            <div class="menu-item" data-action="rename">Rename</div>
            <div class="menu-item" data-action="delete">Delete</div>
        </div>
        
        <!-- Add to Playlist Popup -->
        <div class="add-playlist-popup" id="add-playlist-popup">
            <div style="padding-bottom: 10px; border-bottom: 1px solid #1a1a1a;">
                <input type="text" id="playlist-popup-quick-input" placeholder="Create new playlist..." 
                       style="width: 100%; padding: 8px 12px; background: #0a0a0a; border: 1px solid #1a1a1a; 
                              color: #ccc; border-radius: 4px; font-family: 'Aldrich', sans-serif;">
            </div>
            <div id="playlist-popup-list" style="max-height: 250px; overflow-y: auto;"></div>
        </div>

        <!-- Create Playlist Popup -->
        <div class="create-playlist-popup" id="create-playlist-popup">
            <div class="popup-title">CREATE PLAYLIST</div>
            <input type="text" class="popup-input" id="playlist-name-input" placeholder="Enter playlist name">
            <div class="popup-buttons">
                <button class="popup-btn" id="cancel-playlist-btn">CANCEL</button>
                <button class="popup-btn primary" id="confirm-playlist-btn">CREATE</button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settings-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>SETTINGS</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h3>File Management</h3>
                        <label class="setting-option">
                            <input type="radio" name="file-mode" value="direct" checked>
                            <span>Direct Access Mode</span>
                        </label>
                        <label class="setting-option">
                            <input type="radio" name="file-mode" value="watch">
                            <span>Watch Folder Mode</span>
                        </label>
                        <label class="setting-option">
                            <input type="radio" name="file-mode" value="managed">
                            <span>Managed Library Mode</span>
                        </label>
                        
                        <div class="file-management-info">
                            <div id="file-mode-description">
                                Files are accessed directly from their original location.
                            </div>
                            <div id="watch-folder-settings" style="display:none;">
                                <div>Current folder: <span id="current-watch-folder">Not set</span></div>
                                <button class="folder-select-btn" id="select-watch-folder">SELECT FOLDER</button>
                            </div>
                            <div id="managed-library-settings" style="display:none;">
                                <div>Library location: <span id="library-location">~/Music/Tensai</span></div>
                                <label class="setting-option">
                                    <input type="checkbox" id="copy-on-import" checked>
                                    <span>Copy files to library</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Playback</h3>
                        <label class="setting-option">
                            <input type="checkbox" id="auto-play-next" checked>
                            <span>Auto-play next track</span>
                        </label>
                        <label class="setting-option">
                            <input type="checkbox" id="gapless-playback">
                            <span>Gapless playback</span>
                        </label>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Storage</h3>
                        <div class="file-management-info">
                            <div>Library size: <span id="library-size">0 items</span></div>
                            <div>Storage used: <span id="storage-used">0 MB</span></div>
                            <button class="folder-select-btn" id="clear-cache">CLEAR CACHE</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Modal -->
        <div class="modal" id="delete-modal">
            <div class="modal-content small">
                <div class="modal-header">
                    <h2>DELETE</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="delete-modal-text" id="delete-modal-text">
                        Are you sure you want to delete this item?
                    </div>
                    <div class="modal-btn-group">
                        <button class="modal-btn secondary" id="delete-cancel">CANCEL</button>
                        <button class="modal-btn" id="delete-confirm">DELETE</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rename Modal -->
        <div class="modal" id="rename-modal">
            <div class="modal-content small">
                <div class="modal-header">
                    <h2>RENAME</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="text" id="rename-input" class="modal-input" placeholder="Enter new name">
                    <button class="modal-btn" id="rename-confirm">RENAME</button>
                </div>
            </div>
        </div>
       
        <!-- Edit Image Modal -->
        <div class="modal" id="edit-image-modal">
            <div class="modal-content small">
                <div class="modal-header">
                    <h2>EDIT IMAGE</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="current-image-preview" id="current-image-preview"></div>
                    <input type="file" id="image-file-input" accept="image/*" style="display:none;">
                    <button class="modal-btn" id="select-image-btn">SELECT NEW IMAGE</button>
                    <button class="modal-btn secondary" id="remove-image-btn" style="margin-top: 10px;">REMOVE IMAGE</button>
                </div>
            </div>
        </div>
        
        <!-- Clear Cache Modal -->
        <div class="modal" id="clear-cache-modal">
            <div class="modal-content small">
                <div class="modal-header">
                    <h2>CLEAR ALL DATA</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="clear-cache-warning">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="#ff4444" style="margin: 0 auto 20px; display: block;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                        <p style="font-size: 1rem; color: #ffffff; margin-bottom: 15px;">WARNING: This will permanently delete:</p>
                        <ul style="text-align: left; color: #cccccc; margin-bottom: 20px; padding-left: 20px;">
                            <li>All songs in your library</li>
                            <li>All playlists</li>
                            <li>All settings and preferences</li>
                            <li>Play history</li>
                        </ul>
                        <p style="color: #ff4444; font-weight: bold;">This action cannot be undone!</p>
                    </div>
                    <div class="modal-btn-group">
                        <button class="modal-btn secondary" id="clear-cache-cancel">CANCEL</button>
                        <button class="modal-btn danger" id="clear-cache-confirm">DELETE EVERYTHING</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Background overlay for popups -->
    <div class="modal" id="popup-overlay" style="display: none; z-index: 2000;" onclick="this.style.display='none'; document.getElementById('create-playlist-popup').classList.remove('active');"></div>
</body>
</html>
